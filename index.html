<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pass-the-URL Turn Engine — One-Link Multiplayer</title>
  <style>
    :root { --bg:#0f1115; --fg:#e6e6e6; --muted:#9aa3b2; --accent:#7bd389; --accent2:#7db3ff; --danger:#ff6b6b; --card:#151924; }
    html, body { height:100%; }
    body { margin:0; background:var(--bg); color:var(--fg); font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, sans-serif; }
    .wrap { width:100%; max-width:100%; margin:0 auto; padding:12px; box-sizing:border-box; }
    h1 { font-size:20px; margin:0 0 8px; }
    .muted { color:var(--muted); }
    .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:8px; }
    select, button, input[type="text"] { 
      background:var(--card); color:var(--fg); border:1px solid #23293a; 
      border-radius:12px; padding:10px 12px; outline:none; 
      font-size:14px; width:100%; box-sizing:border-box; 
    }
    .row select, .row button, .row input[type="text"] { width:auto; }
    button { cursor:pointer; min-height:44px; touch-action:manipulation; }
    button.primary { background:linear-gradient(180deg, #1a804a, #175c38); border:1px solid #1b8f52; }
    button.ghost { background:transparent; border-color:#2a3146; }
    .card { background:var(--card); border:1px solid #23293a; border-radius:16px; padding:12px; box-shadow:0 6px 24px rgba(0,0,0,.25); margin-bottom:16px; }
    .grid { display:grid; gap:12px; grid-template-columns: 1fr; }
    .board { display:grid; gap:4px; margin:12px auto; width:100%; max-width:320px; }
    .board button.cell { 
      aspect-ratio:1/1; font-size:min(5vw, 24px); font-weight:700; 
      border-radius:8px; border:1px solid #2a3146; background:#0d1018; width:100%;
    }
    .board button.cell:hover { outline:2px solid #25304a; }
    .c4 { 
      display:grid; grid-template-rows:28px repeat(6,1fr); gap:4px; 
      padding:6px; background:#0b0f18; border-radius:12px; 
      border:1px solid #2a3146; width:100%; max-width:320px; margin:0 auto;
    }
    .c4 .tops { display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; }
    .c4 .row { display:grid; grid-template-columns: repeat(7, 1fr); gap:4px; margin:0; }
    .disc { 
      aspect-ratio:1/1; border-radius:50%; display:grid; place-items:center; 
      border:1px solid #2a3146; background:#0d1018; font-size:min(5vw, 20px); font-weight:800; 
    }
    .disc.X { background:#15361f; box-shadow: inset 0 0 0 2px #1b8f52; color:#9af5b8; }
    .disc.O { background:#12243d; box-shadow: inset 0 0 0 2px #245aa7; color:#9cc5ff; }
    .pill { 
      display:inline-flex; align-items:center; justify-content:center; gap:6px; 
      padding:4px 8px; border-radius:999px; background:#101625; border:1px solid #2a3146;
      min-height:32px; margin:2px; flex:1; min-width:0; white-space:nowrap;
    }
    .tag { font-size:12px; color:var(--muted); }
    .small { font-size:12px; }
    .status { padding:10px 12px; border-radius:12px; background:#0d1018; border:1px solid #2a3146; margin-bottom:12px; }
    .linkbox { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .linkbox input { flex:1; min-width:0; }
    .linkbox button, .linkbox a { width:auto; white-space:nowrap; }
    a { color:var(--accent2); text-decoration:none; padding:10px 12px; display:inline-block; }
    .ribbon { 
      display:flex; gap:8px; overflow-x:auto; padding:8px; 
      background:#0b0f18; border:1px solid #23293a; border-radius:12px; 
      margin-bottom:12px; -webkit-overflow-scrolling:touch; 
    }
    .chip { 
      padding:6px 8px; border-radius:999px; border:1px solid #2a3146; 
      background:#0d1018; font-size:12px; white-space:nowrap; 
      min-height:32px; display:flex; align-items:center;
    }
    .chip.active { outline:2px solid #245aa7; }
    .pills-row { 
      display:flex; flex-wrap:wrap; gap:4px; margin-bottom:12px; 
      justify-content:center;
    }
    .controls-row { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:12px; }
    .controls-row > * { flex:1; min-width:120px; }
    .controls-row button { width:100%; }
    
    /* Media queries - Mobile first approach */
    @media (min-width: 480px) {
      .wrap { padding:16px; }
      .board button.cell { font-size:24px; }
    }
    @media (min-width: 768px) {
      .wrap { padding:20px; max-width:90%; }
      h1 { font-size:22px; }
      .board { gap:6px; }
      .row { gap:12px; }
      .linkbox { flex-wrap:nowrap; }
    }
    @media (min-width: 980px){ 
      .wrap { padding:24px; max-width:980px; }
      .grid { grid-template-columns: 1.2fr .8fr; } 
      .board { max-width:360px; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Pass-the-URL Turn Engine <span class="muted">(modular)</span></h1>
  <div class="muted" style="margin-bottom:16px;">Popularity flips rules. At 10 views: a cell is forbidden / palette shrinks. At 25: forced corners / canvas decay. At 50: <b>Turn Budget</b> = 2 moves per turn.</div>

  <div class="grid">
    <div class="card">
      <div class="controls-row">
        <div>
          <label class="tag" for="gameSel">Game</label>
          <select id="gameSel"></select>
        </div>
        <button id="newBtn" class="primary">New Game</button>
        <button id="swapBtn" class="ghost" title="Swap who starts">Swap Start</button>
      </div>

      <div class="pills-row">
        <div class="pill"><span class="tag">Turn</span> <strong id="turnWho">—</strong></div>
        <div class="pill" id="modePill"><span class="tag">Mode</span> <strong>—</strong></div>
        <div class="pill"><span class="tag">Budget</span> <strong id="budgetLeft">—</strong></div>
      </div>

      <div id="viewport"></div>

      <div style="margin-top:12px;">
        <div class="status" id="status">Ready.</div>
        <div class="pills-row">
          <div class="pill"><span class="tag">Views</span> <strong id="viewsCount">0</strong></div>
          <div class="pill"><span class="tag">Sharers</span> <strong id="sharersCount">0</strong></div>
          <div class="pill"><span class="tag">Friends played</span> <strong id="friendsCount">0</strong></div>
        </div>

        <div class="ribbon" id="historyRibbon" title="History (last 24 moves)"></div>

        <div class="linkbox">
          <input id="shareLink" type="text" readonly/>
          <button id="copyBtn">Copy</button>
          <a id="openLink" target="_blank" rel="noopener">Open</a>
        </div>
        <div class="controls-row">
          <button id="reshareBtn" class="ghost" title="Flush session views into URL">Reshare w/ meta</button>
        </div>
        <div class="small muted">This link carries state, metadata, and a compact move history (bounded) — no servers.</div>
      </div>
    </div>

    <div class="card">
      <h3 class="panel-title">Players & Spectators</h3>
      <div class="controls-row">
        <input id="aliasInput" type="text" placeholder="Your alias (optional)">
        <button id="saveAliasBtn" class="ghost">Save Alias</button>
      </div>
      <div class="controls-row">
        <button id="claimX" class="ghost">Claim X</button>
        <button id="claimO" class="ghost">Claim O</button>
        <button id="releaseSeat" class="ghost">Release Seat</button>
      </div>
      <div class="small muted" style="margin-top:8px;">
        Spectator by default. Only the seat owner for the current turn can act. History ribbon shows last 24 moves; replays are local-only (no URL inflation).
      </div>
    </div>
  </div>
</div>

<script type="module" src="./js/core.js"></script>
</body>
</html>
